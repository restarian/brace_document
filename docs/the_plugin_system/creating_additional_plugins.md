## Creating plugins

---
### Brace document pages
* [Contributer code of conduct](https://github.com/restarian/brace_document/blob/master/docs/contributer_code_of_conduct.md)
* [Guilines for contributing](https://github.com/restarian/brace_document/blob/master/docs/guilines_for_contributing.md)
* [Synopsis](https://github.com/restarian/brace_document/blob/master/docs/synopsis.md)
* Specification
  * [License information](https://github.com/restarian/brace_document/blob/master/docs/specification/license_information.md)
* The plugin system
  * [Allocating plugins on the system](https://github.com/restarian/brace_document/blob/master/docs/the_plugin_system/allocating_plugins_on_the_system.md)
  * **Creating additional plugins**
* Using brace document
  * [Command line usage](https://github.com/restarian/brace_document/blob/master/docs/using_brace_document/command_line_usage.md)
  * [Using the module directly](https://github.com/restarian/brace_document/blob/master/docs/using_brace_document/using_the_module_directly.md)

---

#### The plugin constructor
All plugins must return a function from the require/import call. The function constructor may or may not have a prototype and does not need to return a value. This function will be called with the *document_parse* module as the first parameter.
The module function must also contain and return a function property with the qualifier *runThrough*. The documents *structure* and *data* objects are passed in as the first and second arguments. The function must also call a callback (the third argument), when it is finished so that subsequent plugins can be called when it finishes.

#### Calling the plugin
Plugins are called using a priority integer value from the *package.json* file. Lower priority values will cause the plugin to run firstly. Plugins which modify the *data* object should be called last so that other plugins which create new files via the *structure* and new *data* entries will also operated on by them. For example, given the scenario that a plugin which adds a new document page is called after the [brace_document_navlink](https://npmjs.org/packages/brace_document_navlink), the new page will not have the navigation links added to it like the others. Therefore, this is avoided by settings the priority of it to a lower value than *brace_document_navlink*.

**Example package.json entry for the priority value:**
```javascript
{
	"name": "brace_document_myplugin",
	"version": "0.1.2",
	"main": "lib/brace_document_myplugin.js",
	"priority": "2", <-- the value which will be used to establish a calling order.
	...
```


**Below is the minimum structure needed to create a Brace document plugin:**
```javascript
module.exports = function() {
	this.runThrough = function(structure, data, cb) {
		// The callback must be called when the plugin finises so that the other plugins are called.	
		cb()
	}
	return this
}

// Here is another way of doing the same thing as above but with prototypes
var plugin = function() { }
plugin.prototype.runThrough = function(structure, data, cb) {
	// The callback must be called when the plugin finises so that the other plugins are called.	
	cb()
}
module.exports = plugin
```

**This example plugin contains all of the data which is available to the plugins:**
```javascript

// The brace_document_instance and bracket_print_instance arguments are optional but it is recommeded to save these to the plugin constructor like below.
module.exports = function(document_parse_instance, bracket_print_instance) {
	
	// The API members in here can be used within the plugins for advanced usage.
	this.parser = brace_document_instance
	// Setting the options from the parser to the plugin is reccomended sense the option data collected from all of the plugins will be available in it.
	this.option = this.parser.option

	this.runThrough = function(structure, data, cb) {
		// The callback must be called when the plugin finises so that the other plugins are called.	
		cb()
	}
	return this
}
```

**Note: both the *structure* and *data* objects are mutated by the various plugins. Any one paticular plugin must consider if/how another plugin may have mutated the structure and/or data objects in order to prevent an error condition.**

#### The *structure* object
The *structure* object is an Array generated by the **document_parse.createStructure** API member and is the first parameter passed into the *runThrough* method found in the plugin constructor object. It is representative of the directories and files which will be created by the **document_parse.createStructure** API member. The object entries can be re-ordered to create a different directory structure before *createStructure* is called.

#### The *data* object
The *data* object is an object generated by the **document_parse.acquireData** API member and is the second parameter passed into *runThrough*. It is representative of the file meta data and contains the document content. The object keys in this object correspond to the *structure* object which is the only way of knowing where they will end up in the directory structure.

#### Some optional data
All plugins located by brace document will be checked for a *option.js* script located in the base directory of the plugin (subdirectories are not checked). The option data is appended into the *document_parse* option data and available for use in any of the other available plugins.  

**The script below demonstates basic *option.js* data form:**

```javascript
module.exports = [

	{ 
		"usage": "Some text about the plugin and any helpfull data to know when at the command line."
	},
	{
		"flag": "-a, --alpha <string>", 
		"help": "A option to use in this plugin.",
		"default": "AAA", 
	},
	{
		"flag": "-b, ---beta <string>", 
		"help": "Set this to the beta word.",
		"setter" function(val) { return val + "_beta" } 
	},
	{
		"flag": "-f", 
		"help": "A simple flag to set"
	},
]
```

